{"version":3,"file":"multiselect_tags.min.js","sources":["../src/multiselect_tags.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Helper that hides the fallback select and delegates to the autocomplete enhancer.\n *\n * @module     mod_bigbluebuttonbn/multiselect_tags\n * @copyright  2025 Blindside Networks Inc\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author     Jesus Federico  (jesus [at] blindsidenetworks [dt] com)\n */\ndefine(['jquery', 'core/form-autocomplete'], function($, autocomplete) {\n    /**\n     * Initialise autocomplete and enforce capitalization for newly typed tags.\n     *\n     * @param {string} selector Selector for the original select element.\n     * @return {Promise}\n     */\n    const init = function(selector) {\n        const args = Array.prototype.slice.call(arguments);\n        const $select = $(selector);\n\n        return autocomplete.enhance.apply(autocomplete, args).then(function() {\n            // Handler to normalize and check for duplicates.\n            var processOptions = function() {\n                // First pass: collect all existing normalized values from preset options.\n                var existingValues = {};\n                $select.find('option:not([data-iscustom])').each(function() {\n                    var val = $(this).attr('value');\n                    if (val) {\n                        existingValues[val.toLowerCase()] = true;\n                    }\n                });\n\n                // Second pass: process custom options and check for duplicates.\n                var toRemove = [];\n                $select.find('option[data-iscustom]').each(function() {\n                    var $opt = $(this);\n                    var val = $opt.attr('value');\n                    if (!val) {\n                        return;\n                    }\n\n                    var normalized = val.toLowerCase();\n\n                    // Check if this normalized value already exists.\n                    if (existingValues[normalized]) {\n                        // Mark for removal.\n                        toRemove.push({opt: $opt, val: val});\n                        return;\n                    }\n\n                    // Mark this value as seen for subsequent custom options.\n                    existingValues[normalized] = true;\n\n                    var display = normalized.replace(/[_-]/g, ' ').replace(/\\s+/g, ' ').trim();\n                    display = display.replace(/\\b\\w/g, function(c) {\n                        return c.toUpperCase();\n                    });\n\n                    $opt.attr('value', normalized);\n                    $opt.text(display);\n\n                    // Update the visible pill label to match the capitalized display text.\n                    var $pill = $select.parent().find('.form-autocomplete-selection [data-value=\"' + val + '\"]');\n                    if ($pill.length) {\n                        $pill.attr('data-value', normalized);\n                        var $textNodes = $pill.contents().filter(function() {\n                            return this.nodeType === 3;\n                        });\n                        // Use the last text node (label) to avoid touching leading whitespace.\n                        var $labelNode = $textNodes.last();\n                        if ($labelNode.length) {\n                            $labelNode[0].nodeValue = ' ' + display;\n                        }\n                    }\n                });\n\n                // Remove duplicates after iteration to avoid modifying collection during iteration.\n                toRemove.forEach(function(item) {\n                    item.opt.remove();\n                    $select.parent().find('.form-autocomplete-selection [data-value=\"' + item.val + '\"]').remove();\n                });\n            };\n\n            // Use both change event and a slight delay to catch additions quickly.\n            $select.on('change', function() {\n                // Use setTimeout with 0 to run after the current call stack clears.\n                setTimeout(processOptions, 0);\n            });\n\n            // Also process immediately in case there are existing values.\n            processOptions();\n\n            return $select;\n        });\n    };\n\n    return {init};\n});\n"],"names":["define","$","autocomplete","init","selector","args","Array","prototype","slice","call","arguments","$select","enhance","apply","then","processOptions","existingValues","find","each","val","this","attr","toLowerCase","toRemove","$opt","normalized","push","opt","display","replace","trim","c","toUpperCase","text","$pill","parent","length","$labelNode","contents","filter","nodeType","last","nodeValue","forEach","item","remove","on","setTimeout"],"mappings":";;;;;;;;AAuBAA,8CAAO,CAAC,SAAU,2BAA2B,SAASC,EAAGC,oBAuF9C,CAACC,KAhFK,SAASC,gBACZC,KAAOC,MAAMC,UAAUC,MAAMC,KAAKC,WAClCC,QAAUV,EAAEG,iBAEXF,aAAaU,QAAQC,MAAMX,aAAcG,MAAMS,MAAK,eAEnDC,eAAiB,eAEbC,eAAiB,GACrBL,QAAQM,KAAK,+BAA+BC,MAAK,eACzCC,IAAMlB,EAAEmB,MAAMC,KAAK,SACnBF,MACAH,eAAeG,IAAIG,gBAAiB,UAKxCC,SAAW,GACfZ,QAAQM,KAAK,yBAAyBC,MAAK,eACnCM,KAAOvB,EAAEmB,MACTD,IAAMK,KAAKH,KAAK,YACfF,SAIDM,WAAaN,IAAIG,iBAGjBN,eAAeS,YAEfF,SAASG,KAAK,CAACC,IAAKH,KAAML,IAAKA,WAKnCH,eAAeS,aAAc,MAEzBG,QAAUH,WAAWI,QAAQ,QAAS,KAAKA,QAAQ,OAAQ,KAAKC,OACpEF,QAAUA,QAAQC,QAAQ,SAAS,SAASE,UACjCA,EAAEC,iBAGbR,KAAKH,KAAK,QAASI,YACnBD,KAAKS,KAAKL,aAGNM,MAAQvB,QAAQwB,SAASlB,KAAK,6CAA+CE,IAAM,SACnFe,MAAME,OAAQ,CACdF,MAAMb,KAAK,aAAcI,gBAKrBY,WAJaH,MAAMI,WAAWC,QAAO,kBACZ,IAAlBnB,KAAKoB,YAGYC,OACxBJ,WAAWD,SACXC,WAAW,GAAGK,UAAY,IAAMd,eAM5CL,SAASoB,SAAQ,SAASC,MACtBA,KAAKjB,IAAIkB,SACTlC,QAAQwB,SAASlB,KAAK,6CAA+C2B,KAAKzB,IAAM,MAAM0B,oBAK9FlC,QAAQmC,GAAG,UAAU,WAEjBC,WAAWhC,eAAgB,MAI/BA,iBAEOJ"}